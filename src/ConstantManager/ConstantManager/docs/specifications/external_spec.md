# 定数管理システム 外部仕様書

**版番:** 1.3  
**作成日:** 2026年1月21日  
**最終更新:** 2026年1月21日  
**対象システム:** 車載ソフトウェア定数管理ツール

---

## 目次

- [1. システム概要](#1-システム概要)
  - [1.1 目的](#11-目的)
  - [1.2 システム構成](#12-システム構成)
  - [1.3 主なユーザー](#13-主なユーザー)
- [2. データ構造](#2-データ構造)
  - [2.1 定数アイテム (Constant Item)](#21-定数アイテム-constant-item)
- [3. 画面UI仕様](#3-画面ui仕様)
  - [3.1 画面レイアウト](#31-画面レイアウト)
  - [3.2 チェックボックス操作仕様](#32-チェックボックス操作仕様)
  - [3.3 メイン画面詳細](#33-メイン画面詳細)
  - [3.4 ダイアログ設計](#34-ダイアログ設計)
  - [3.5 定数編集ダイアログ](#35-定数編集ダイアログ)
  - [3.6 終了確認ダイアログ](#36-終了確認ダイアログ)
- [4. 機能仕様](#4-機能仕様)
  - [4.1 CSVエクスポート機能](#41-csvエクスポート機能)
  - [4.2 CSVインポート機能](#42-csvインポート機能)
  - [4.3 エラー処理](#43-エラー処理)
- [5. ユースケースフロー](#5-ユースケースフロー)
  - [5.1 UC-001: 定数を修正してCSV出力する](#51-uc-001-定数を修正してcsv出力する)
  - [5.2 UC-002: 新規定数を追加する](#52-uc-002-新規定数を追加する)
  - [5.3 UC-003: CSVファイルをインポート・マージする](#53-uc-003-csvファイルをインポートマージする)
  - [5.4 UC-004: 定数を削除する](#54-uc-004-定数を削除する)
  - [5.5 UC-005: アプリケーションを終了する（未保存の変更がある場合）](#55-uc-005-アプリケーションを終了する未保存の変更がある場合)
  - [5.6 UC-006: エラーハンドリング - 不正なCSV形式](#56-uc-006-エラーハンドリング---不正なcsv形式)
- [6. 改版履歴](#6-改版履歴)

---

## 1. システム概要

### 1.1 目的
本システムは、車載ソフトウェアの定数をGUIで一元管理し、CSVファイルを用いた定数データの入出力を可能にするデスクトップアプリケーションです。開発メンバー間での定数値の共有、外部編集、バージョン管理を効率化します。

### 1.2 システム構成
- **GUI 管理画面**: Windowsフォームベースの定数管理インターフェース（メニューバー、グリッド表示）
- **CSV入出力機能**: 定数データのエクスポート・インポート
- **ファイル保存**: 定数データの永続化
- **エラーハンドリング**: 不正なデータ形式や型不一致への対応
- **モーダルダイアログ**: 定数の追加・編集時に専用ダイアログを表示

### 1.3 主なユーザー
- 車載ソフトウェア開発エンジニア
- システムテスト担当者
- プロジェクトマネージャー

---

## 2. データ構造

### 2.1 定数アイテム (Constant Item)

定数管理システムで扱う最小単位のデータ構造を以下に定義します：

| 項目名 | 型 | 必須 | 制限・備考 |
|--------|-----|------|----------|
| **PhysicalName（定数名/物理名）** | 文字列 | ◎ | システムの主キーであり、C言語コードの変数名。英大文字とアンダースコアのみ。最大32文字。新規作成時は入力可、既存編集時は読み取り専用。 |
| **LogicalName（日本語名/論理名）** | 文字列 | ◎ | 定数の日本語名（論理名）。最大64文字。 |
| **Value（値）** | 数値/文字列 | ◎ | 設定値。数値またはテキスト。 |
| **Unit（単位）** | 文字列 | ○ | 単位情報（例："℃", "km/h", "V"）。最大16文字。省略可能。 |
| **Description（説明）** | 文字列 | ○ | 定数の説明・用途。最大256文字。省略可能。 |

**注記:**
- PhysicalName は CSVインポート時の主キーとして機能
- Value は数値、小数、負数、または文字列を受け付ける
- 日本語を含むテキストは UTF-8 で処理
- PhysicalName（定数名/物理名）は変数名として C言語コードで使用される

---

## 3. 画面UI仕様

### 3.1 画面レイアウト

#### 3.1.1 全体構成

```
┌────────────────────────────────────────────────────────┐
│ 定数管理ツール                                         │
├────────────────────────────────────────────────────────┤
│ ファイル(F)  編集(E)                                  │  ← メニューバー（MenuStrip）
├────────────────────────────────────────────────────────┤
│ ┌──┬──────────────┬──────────────┬────┬────┬──────┐ │
│ │選│定数名(物理名) │日本語名(論理) │値  │単位│説明  │ │  ← グリッドヘッダー
│ ├──┼──────────────┼──────────────┼────┼────┼──────┤ │
│ │? │ENGINE_TEMP   │エンジン温度   │120 │℃  │最高... │  ← データ行1（黄色背景）
│ │? │SPEED_LIMIT   │速度制限      │100 │k/ │法定... │  ← データ行2（白背景）
│ │  │              │              │    │   │     │ │
│ │  │ …スクロール可… │              │    │   │     │ │
│ │  │              │              │    │   │     │ │
│ └──┴──────────────┴──────────────┴────┴────┴──────┘ │
│                                                        │
├────────────────────────────────────────────────────────┤
│ 全 5 件                          │ ← ステータスバー      │
└────────────────────────────────────────────────────────┘
```

#### 3.1.2 コントロール仕様

**メニューバー（MenuStrip）:**
- **[ファイル(F)]**
  - 読込(O)... - CSVファイルをインポート。既存データを上書きまたはマージするかを選択
  - 保存(S) - 現在のデータセットをCSVファイルにエクスポート（全行）
  - CSVエクスポート(E)... - チェックボックスで選択した行のみをCSVファイルにエクスポート
- **[編集(E)]**
  - 新規追加(A)... - 新規定数追加ダイアログを表示
  - 編集(D)... - 選択行の定数編集ダイアログを表示
  - 削除(L) - チェックボックスで選択した行を削除

**グリッド表示:**
- **DataGridView** コントロール
- **6列構成:**
  - 第1列: 選択チェックボックス（幅: 50px 固定）
  - 第2列: 定数名(物理名)（幅: 自動調整）
  - 第3列: 日本語名(論理名)（幅: 自動調整）
  - 第4列: 値（幅: 自動調整）
  - 第5列: 単位（幅: 自動調整）
  - 第6列: 説明（幅: 自動調整）
- **選択方法**: チェックボックスでの複数行選択対応
- **ソート機能**: カラムヘッダークリックでソート可能

**選択状態の表示:**
- チェックボックスが `ON` になった行の背景色: **薄い黄色（LightYellow / RGB(255, 255, 200)）**
- チェックボックスが `OFF` の行の背景色: **白色（White）**
- 選択状態がリアルタイムで反映される（クリック直後に背景色が変わる）

**ステータスバー:**
- 配置: 画面下部
- 表示内容: `"全 {n} 件"` （総行数を表示）

---

### 3.2 チェックボックス操作仕様

#### 3.2.1 チェックボックスの挙動

**基本動作:**
1. ユーザーがグリッド内の第1列のチェックボックスをクリック
2. **即座に値がコミット** される（WinForms の `CurrentCellDirtyStateChanged` イベントにより確定）
3. チェック状態が確定した瞬間に、該当行の背景色が変更される
   - チェック `ON` → 背景色を **LightYellow（薄い黄色）** に変更
   - チェック `OFF` → 背景色を **White（白）** に変更

**動作の流れ:**
```
ユーザーがチェックボックスをクリック
  ↓
CurrentCellDirtyStateChanged イベント発火
  ↓
CommitEdit() でチェック状態をコミット
  ↓
CellValueChanged イベント発火
  ↓
チェック状態に応じて背景色を更新（リアルタイム反映）
```

**利点:**
- チェック直後にボタンをクリックしても、チェック状態が確実に反映される
- ユーザーが「チェック状態が反映されていない」という混乱を避けることができる
- 視覚的フィードバック（黄色ハイライト）により、選択状態が明確になる

---

### 3.3 メイン画面詳細

#### 3.3.1 メニューバー（MenuStrip）
- **配置**: 画面最上部
- **メニュー構成**:
  - **[ファイル(F)]**
    - 読込(O)... - CSVファイルを開く（ファイル選択ダイアログ）
    - 保存(S) - 全データをCSVエクスポート
    - CSVエクスポート(E)... - チェック選択行のみCSVエクスポート
  - **[編集(E)]**
    - 新規追加(A)... - 定数編集ダイアログを新規モードで表示
    - 編集(D)... - 定数編集ダイアログを編集モードで表示
    - 削除(L) - チェック選択行を削除

#### 3.3.2 グリッド表示
- **位置**: 画面中央、メニューバー下からステータスバーの上まで
- **サイズ**: ウィンドウ幅に合わせて自動調整
- **カラム仕様**:
  - 第1列（選択）: 50px（固定）- チェックボックス
  - 第2列（定数名/物理名）: 自動調整
  - 第3列（日本語名/論理名）: 自動調整
  - 第4列（値）: 自動調整
  - 第5列（単位）: 自動調整
  - 第6列（説明）: 残り全幅
- **行高**: 24px
- **選択モード**: チェックボックスによる複数行選択対応
- **ソート**: カラムヘッダークリックでソート可能（昇順/降順）
- **ハイライト**: 
  - チェック `ON` の行は背景色を **LightYellow（薄い黄色）** に表示
  - チェック `OFF` の行は背景色を **White（白）** に表示
  - **リアルタイム更新**: チェックボックスをクリックした瞬間に背景色が変更される

#### 3.3.3 ステータスバー
- **配置**: 画面下部
- **表示内容**:
  - 総行数: "全 {n} 件"

---

### 3.4 ダイアログ設計

#### 3.4.1 [ファイル] - [読込] - CSVファイル選択ダイアログ
```
ファイルを開く
─────────────────────────────
場所: [C:\Users\...\]
ファイル名: [_________________]
ファイルの種類: [CSV ファイル (*.csv)]

[ マージモード ○] [ 置換モード ○]

[開く] [キャンセル]
─────────────────────────────
```

#### 3.4.2 [ファイル] - [保存] / [CSVエクスポート] - ファイル保存ダイアログ
```
名前を付けて保存
─────────────────────────────
場所: [C:\Users\...\]
ファイル名: [constants_YYYYMMDD.csv]
ファイルの種類: [CSV ファイル (*.csv)]

[保存] [キャンセル]
─────────────────────────────
```

#### 3.4.3 エラー確認ダイアログ
```
[エラー]
─────────────────────────────
{エラーメッセージ}

詳細情報:
{エラー詳細（複数行可）}

[OK] [詳細を表示] [ログに保存]
─────────────────────────────
```

---

### 3.5 定数編集ダイアログ

#### 3.5.1 概要
定数の新規追加または既存データの編集を行うモーダルダイアログです。新規追加モードと既存編集モードの2つの状態があります。

#### 3.5.2 レイアウト

```
┌─────────────────────────────────┐
│ 定数新規追加                     │
├─────────────────────────────────┤
│                                 │
│ 定数名(物理名):                  │
│ [_________________]              │
│                                 │
│ 日本語名(論理名):                │
│ [_________________]              │
│                                 │
│ 値:                             │
│ [_________________]              │
│                                 │
│ 単位:                           │
│ [__________]                    │
│                                 │
│ 説明:                           │
│ [_________________________]      │
│ [_________________________]      │
│ [_________________________]      │
│                                 │
│              [OK] [キャンセル]   │
│                                 │
└─────────────────────────────────┘
```

#### 3.5.3 フィールド仕様

| フィールド名 | 入力形式 | 最大文字数 | 新規モード | 編集モード | 備考 |
|------------|---------|----------|----------|----------|------|
| **定数名(物理名)** | テキストボックス | 32 | 入力可 | 読み取り専用 | 英大文字・アンダースコアのみ。編集モードではフォーカス不可、グレーアウト表示 |
| **日本語名(論理名)** | テキストボックス | 64 | 入力可 | 入力可 | 日本語対応。必須項目 |
| **値** | テキストボックス | 256 | 入力可 | 入力可 | 数値または文字列。必須項目 |
| **単位** | テキストボックス | 16 | 入力可 | 入力可 | 省略可能 |
| **説明** | マルチラインテキストボックス | 256 | 入力可 | 入力可 | 複数行対応。省略可能 |

#### 3.5.4 ボタン仕様

- **[OK]** - 入力値を検証し、グリッドに新規行を追加または選択行を更新して、ダイアログを閉じる
  - 検証エラーがある場合は、エラーメッセージを表示し、ダイアログを開いたまま
- **[キャンセル]** - 入力内容を破棄してダイアログを閉じる

#### 3.5.5 モード別の動作

**新規追加モード（新しい定数を追加）:**
- タイトル: "定数新規追加"
- 定数名(物理名): 入力可能、フォーカスあり（最初のフィールド）
- 他フィールド: 空白
- [OK] 押下時: 新規行をグリッドの最後に追加

**既存編集モード（選択した行を編集）:**
- タイトル: "定数編集"
- 定数名(物理名): 読み取り専用、グレーアウト、フォーカス不可
- 他フィールド: 選択行の値が自動入力される
- フォーカス: 日本語名(論理名)に設定
- [OK] 押下時: グリッド内の選択行を更新

---

### 3.6 終了確認ダイアログ

#### 3.6.1 概要
ウィンドウの「×」ボタン（閉じるボタン）が押下された際に、未保存の変更がある場合に表示されるダイアログです。

#### 3.6.2 レイアウト

```
┌──────────────────────────────┐
│ 定数管理ツール               │
├──────────────────────────────┤
│                              │
│ 保存されていない変更があります│
│ ファイルに保存しますか?      │
│                              │
│  [はい(保存して終了)]        │
│  [いいえ(保存せず終了)]      │
│  [キャンセル]                │
│                              │
└──────────────────────────────┘
```

#### 3.6.3 ボタン仕様

- **[はい(保存して終了)]** - 現在のデータセットをCSVファイルにエクスポート（全行）後、アプリケーションを終了
  - 保存に失敗した場合は、エラーメッセージを表示し、アプリケーションは終了しない
- **[いいえ(保存せず終了)]** - 変更を破棄してアプリケーションを終了
- **[キャンセル]** - ダイアログを閉じ、アプリケーションを開いたまま

---

## 4. 機能仕様

### 4.1 CSVエクスポート機能

#### 4.1.1 仕様

- **対象データ**: グリッドのチェックボックスで `ON` になっている行のみをCSV形式で出力
  - チェックボックスが `OFF` の行は除外される
  - 複数行選択可能
- **最小選択数**: 1行以上必須。0行の場合はエラーメッセージを表示
- **ヘッダー行**: 必ず1行目に各カラム名を含める
- **カラム名**: `PhysicalName,LogicalName,Value,Unit,Description`
- **文字コード**: UTF-8（BOM付き必須）
- **改行コード**: CRLF（Windows標準）
- **ファイル形式**: `.csv`
- **デリミタ**: カンマ `,`

#### 4.1.2 出力例

```csv
PhysicalName,LogicalName,Value,Unit,Description
ENGINE_TEMP_MAX,エンジン最高温度,120,℃,エンジンの最大許容温度
SPEED_LIMIT,速度制限,100,km/h,法定速度制限
BATTERY_VOLTAGE,バッテリー電圧,12.0,V,正常動作時の基準電圧
```

#### 4.1.3 特殊文字の処理

- CSVデータ内にカンマやダブルクォートを含む場合は、ダブルクォートで囲む
- 改行を含む場合はダブルクォートで囲む

**例:**
```csv
PhysicalName,LogicalName,Value,Unit,Description
SENSOR_RANGE,センサー検出範囲,"0-100","%","正常範囲: 0～100"
```

---

### 4.2 CSVインポート機能

#### 4.2.1 仕様

- **ファイル形式**: `.csv` ファイル
- **文字コード**: UTF-8（BOM付き必須）、SHIFT_JIS にも対応
- **処理ロジック**:
  1. CSVファイルを読み込む
  2. ヘッダー行をスキップ
  3. 各データ行に対し:
     - **PhysicalName が既に存在** → 既存行を更新
     - **PhysicalName が新規** → 新規行として追加
- **マージモード**: 既存データと新規データをマージ（デフォルト動作）
- **置換モード**: 既存データをすべて削除して新データで置換

#### 4.2.2 インポート時の検証

| 検証項目 | 内容 | エラー時の動作 |
|---------|------|----------------|
| **ヘッダー行** | PhysicalName, LogicalName, Value, Unit, Description が存在することを確認 | エラー表示、インポート中止 |
| **必須項目** | PhysicalName, LogicalName, Value が空でないことを確認 | その行をスキップ、警告表示 |
| **PhysicalName 形式** | 英大文字とアンダースコアのみ、最大32文字 | エラー表示、その行をスキップ |
| **Value 型** | 数値または文字列を判定（自動判別） | そのまま受け入れ |
| **重複チェック** | 同一ファイル内での PhysicalName 重複を検出 | エラー表示、後の行を優先 |

---

### 4.3 エラー処理

#### 4.3.1 エラーメッセージ一覧

| エラーコード | メッセージ | 原因 | ユーザーアクション |
|------------|-----------|------|------------------|
| **E001** | "ファイルが見つかりません" | 指定ファイルが存在しない | ファイルパスを確認 |
| **E002** | "ファイルの読み込みに失敗しました" | ファイルロック、権限不足 | ファイルを閉じるか権限を確認 |
| **E003** | "不正なCSV形式です（ヘッダー行が不正）" | ヘッダー行が仕様と異なる | CSVファイル形式を確認 |
| ~~**E004**~~ | ~~"エンコーディングが認識できません"~~ | ~~サポート外の文字コード~~ | ~~UTF-8 または SHIFT_JIS に変換~~ **(欠番: E002に統合)** |
| **E005** | "データ行 {行番号}: PhysicalName が空です" | 必須項目が欠落 | その行の PhysicalName を入力 |
| **E006** | "データ行 {行番号}: LogicalName が空です" | 必須項目が欠落 | その行の LogicalName を入力 |
| **E007** | "データ行 {行番号}: Value が空です" | 必須項目が欠落 | その行の Value を入力 |
| **E008** | "データ行 {行番号}: PhysicalName の形式が不正です（英大文字とアンダースコアのみ）" | PhysicalName が仕様を逸脱 | 正しい形式に修正 |
| **E009** | "データ行 {行番号}: PhysicalName の長さが上限を超えています（最大32文字）" | PhysicalName が長すぎる | 32文字以内に短縮 |
| **E010** | "データ行 {行番号}: 重複する PhysicalName があります（{PhysicalName}）" | 同一ファイル内で PhysicalName が重複 | PhysicalName を修正 |
| **E011** | "保存に失敗しました（ディスク容量不足）" | ストレージ容量不足 | ストレージを確認・清掃 |
| **E012** | "ファイルへの書き込み権限がありません" | 権限不足 | ファイルの権限設定を確認 |
| **W001** | "警告: データ行 {行番号} は必須項目が欠落しているためスキップされました" | 不完全な行がある | 該当行を確認・修正 |
| **W002** | "警告: {n} 行のデータがインポートされました。{m} 行はスキップされました" | 一部の行がスキップされた | 結果を確認 |

#### 4.3.2 エラーダイアログ例

```
[エラー]
───────────────────────────────
データ行 5: PhysicalName の形式が不正です
（英大文字とアンダースコアのみ）

PhysicalName: "Engine-Temp" は無効な文字を含みます

[OK]
───────────────────────────────
```

---

## 5. ユースケースフロー

### 5.1 UC-001: 定数を修正してCSV出力する

**前提条件**: 定数管理システムが起動している

**主シーン**:

| ステップ | アクター | アクション | システム応答 |
|---------|---------|-----------|-----------|
| 1 | ユーザー | [ファイル] → [読込]をクリック | ファイル選択ダイアログが表示 |
| 2 | ユーザー | 既存のCSVファイルを選択し、[開く] | CSV ファイルを読み込みして検証 |
| 3 | システム | - | グリッドに読み込んだデータを表示。ステータスに行数を表示 |
| 4 | ユーザー | グリッド内で修正対象行のチェックボックスをチェック | 選択行が黄色（LightYellow）でハイライト。値がリアルタイムでコミット |
| 5 | ユーザー | [編集] → [編集]をクリック | 定数編集ダイアログ（編集モード）が開く |
| 6 | ユーザー | 日本語名や値などを修正し [OK]をクリック | グリッド内のデータが更新される、ダイアログが閉じる |
| 7 | ユーザー | 修正対象行（1～5行）を複数チェック選択し、[ファイル] → [CSVエクスポート] | ファイル保存ダイアログが表示 |
| 8 | ユーザー | ファイル名を入力し [保存] | チェック選択されている行のみがCSVに出力される |
| 9 | システム | - | 「保存完了」メッセージ表示 |

**終了条件**: チェック選択行のみがCSVファイルに出力される

---

### 5.2 UC-002: 新規定数を追加する

**前提条件**: 定数管理システムが起動している、グリッドにデータが表示されている

**主シーン**:

| ステップ | アクター | アクション | システム応答 |
|---------|---------|-----------|-----------|
| 1 | ユーザー | [編集] → [新規追加]をクリック | 定数編集ダイアログ（新規モード）が開く |
| 2 | ユーザー | 定数名(物理名)に "NEW_CONSTANT" を入力 | テキストボックスに入力される |
| 3 | ユーザー | 日本語名(論理名)に "新規定数" を入力 | テキストボックスに入力される |
| 4 | ユーザー | 値に "100" を入力 | テキストボックスに入力される |
| 5 | ユーザー | 単位に "℃" を入力 | テキストボックスに入力される |
| 6 | ユーザー | 説明に "説明" を入力 | テキストボックスに入力される |
| 7 | ユーザー | [OK]をクリック | 新規行がグリッド最後に追加される、ダイアログが閉じる |
| 8 | ユーザー | [ファイル] → [保存]をクリック | ファイル保存ダイアログ表示 |
| 9 | ユーザー | ファイルを保存 | "保存完了"メッセージ表示 |

**終了条件**: 新規定数がグリッドに追加され、CSVファイルに反映される

---

### 5.3 UC-003: CSVファイルをインポート・マージする

**前提条件**: 定数管理システムが起動している、既存データが存在

**主シーン**:

| ステップ | アクター | アクション | システム応答 |
|---------|---------|-----------|-----------|
| 1 | ユーザー | [ファイル] → [読込]をクリック | ファイル選択ダイアログが表示 |
| 2 | ユーザー | 外部編集後のCSVファイルを選択 | ファイル名がダイアログに表示 |
| 3 | ユーザー | マージモードを選択して [開く] | CSV ファイルを読み込んで検証 |
| 4 | システム | - | 既存 PhysicalName と新規 PhysicalName を比較処理 |
| 5 | システム | - | 既存 PhysicalName は値を更新、新規 PhysicalName は行を追加 |
| 6 | システム | - | グリッドを更新、完了メッセージ表示 |
| 7 | ユーザー | [ファイル] → [保存]をクリック | ファイル保存ダイアログ表示 |
| 8 | ユーザー | ファイルを保存 | マージされたデータが保存される |

**終了条件**: 既存データが更新され、新規データが追加されたCSVが生成される

---

### 5.4 UC-004: 定数を削除する

**前提条件**: 定数管理システムが起動している、グリッドにデータが表示されている

**主シーン**:

| ステップ | アクター | アクション | システム応答 |
|---------|---------|-----------|-----------|
| 1 | ユーザー | グリッド内で削除対象行のチェックボックスをチェック | 選択行が黄色（LightYellow）でハイライト。値がリアルタイムでコミット |
| 2 | ユーザー | [編集] → [削除]をクリック | チェック選択されている行がグリッドから削除される |
| 3 | ユーザー | [ファイル] → [保存]をクリック | ファイル保存ダイアログ表示 |
| 4 | ユーザー | ファイルを保存 | 削除済みデータが反映されたCSVが保存される |

**終了条件**: チェック選択行のみがグリッドから削除され、CSVファイルに反映される

---

### 5.5 UC-005: アプリケーションを終了する（未保存の変更がある場合）

**前提条件**: 定数管理システムが起動している、未保存の変更がある

**主シーン**:

| ステップ | アクター | アクション | システム応答 |
|---------|---------|-----------|-----------|
| 1 | ユーザー | グリッドデータを修正 | グリッド内のデータが更新される |
| 2 | ユーザー | ウィンドウの「×」ボタンをクリック | 終了確認ダイアログが表示 |
| 3 | ユーザー | [はい(保存して終了)]をクリック | 現在のデータセットをCSVファイルにエクスポート |
| 4 | システム | - | ファイル保存ダイアログが表示 |
| 5 | ユーザー | ファイルを保存 | アプリケーションが終了 |

**終了条件**: 変更内容が保存され、アプリケーションが終了される

---

### 5.6 UC-006: エラーハンドリング - 不正なCSV形式

**前提条件**: 不正なフォーマットのCSVファイルが存在

**主シーン**:

| ステップ | アクター | アクション | システム応答 |
|---------|---------|-----------|-----------|
| 1 | ユーザー | [ファイル] → [読込]をクリック | ファイル選択ダイアログが表示 |
| 2 | ユーザー | 不正なCSVファイルを選択して [開く] | ファイル読み込み・検証処理開始 |
| 3 | システム | - | ヘッダー行を検証 → 不正を検出 |
| 4 | システム | - | エラーダイアログ表示: "E003: 不正なCSV形式です（ヘッダー行が不正）" |
| 5 | ユーザー | エラーダイアログで [OK] | ダイアログが閉じられ、グリッドは変更なし |

**終了条件**: エラーが表示され、既存データは保全される

---

## 6. 改版履歴

| 版番 | 作成日 | 変更内容 |
|------|--------|---------|
| 1.0 | 2026-01-21 | 初版 |
| 1.1 | 2026-01-21 | マイナー修正 |
| 1.2 | 2026-01-21 | 外部仕様書の整備版 |
| 1.3 | 2026-01-21 | **実装に基づく修正**: グリッド列名を日本語に統一。チェックボックスの背景色ハイライト（LightYellow）、即座確定、リアルタイム反映を明記。エクスポート・削除がチェックボックス対象であることを明記。**構成修正**: 「機能要件」と「画面UI構成案」を統合して新「画面UI仕様」章に再編成 |

---

**ドキュメント管理情報**
- **最終更新**: 2026-01-21
- **ステータス**: 実装版スペック完成
- **対象**: Windows フォームベース 定数管理ツール (.NET 10)
